WHITESPACE = _{ " " | "\n" }
COMMENT = _{ ";" ~ (!"\n" ~ ANY) }

Program = _{ SOI ~ ProgramStmt* ~ EOI }

Expr = { Prefix* ~ PrimaryExpr ~ Postfix* ~ (Infix ~ Prefix* ~ PrimaryExpr ~ Postfix* )* }
    Infix = _{ Add | Sub }
    Prefix = _ { Sub | Not }
    Postfix = _ { Dot }

    Add = { "+" }
    Sub = { "-" }
    Not = { "not" }
    Dot = { "." ~ Ident }

PrimaryExpr = _{
    BlockExpr
    | CallExpr
    | "(" ~ Expr ~ ")"
    | Ident
    | Integer
    | Float
    | String
}

BlockExpr = { "{" ~ Stmt* ~ ValueExpr? ~ "}" }
ValueExpr = { Expr }

CallExpr = { Ident ~ "(" ~ CallArgs ~ ")" }
CallArgs = { (Expr ~ ",")* ~ Expr? }

ProgramStmt = _{
    MakeFunctionStmt
    | Stmt
}

Stmt = _{
    InspectStmt ~ ";"
    | Expr ~ ";"
}

MakeFunctionStmt = { "make" ~ Ident ~ "(" ~ MakeFunctionParams ~ ")" ~ BlockExpr }
MakeFunctionParams = { (Ident ~ ",")* ~ Ident? }

InspectStmt = { "inspect" ~ Expr }

Ident = @{ ASCII_ALPHA ~ (ASCII_ALPHANUMERIC | "_")* }

Integer = @{ ASCII_DIGIT+ }

Float = @{ ASCII_DIGIT+ ~ "." ~ ASCII_DIGIT* }

String = @{ "\"" ~ (!"\"" ~ ANY)* ~ "\"" }
